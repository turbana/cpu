#!/bin/bash

set -e

ASM=$(dirname $0)/../asm/asm.py
SIM=$(dirname $0)/../sim/functional/cpu.py
BUILD=$(dirname $0)/../build

if [[ $# -eq 0 ]]; then
	echo "USAGE: $(basename $0) source.asm"
	exit 2
fi

asm=$1
shift
output=$BUILD/$(basename ${asm%%.asm}).o
macro=${asm%%.asm}.py
[[ ! -f $macro ]] && macro=

mkdir -p $BUILD

$ASM $asm $macro $output
$SIM $output $@
